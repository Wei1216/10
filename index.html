import React, { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";

export default function MarqueeSelector() {
  const [selectedNumber, setSelectedNumber] = useState(null);
  const [questionImages, setQuestionImages] = useState([]);
  const [currentImage, setCurrentImage] = useState(null);
  const [showSymbol, setShowSymbol] = useState(null); // "⭕" 或 "❌"

  const numbers = Array.from({ length: 10 }, (_, i) => i + 1);

  useEffect(() => {
    // 模擬題目圖片
    setQuestionImages([
      "/img1.png",
      "/img2.png",
      "/img3.png",
      "/img4.png",
      "/img5.png",
      "/img6.png",
    ]);
  }, []);

  // 抽題功能
  const handleSelectNumber = (num) => {
    if (showSymbol) return; // 有圈叉顯示時，先不讓抽題
    setSelectedNumber(num);
    const randomImage =
      questionImages[Math.floor(Math.random() * questionImages.length)];
    setCurrentImage(randomImage);
  };

  // 顯示圈叉
  const handleSymbolClick = (symbol) => {
    setShowSymbol(symbol);
    setCurrentImage(null);
    setTimeout(() => {
      // 1秒後自動恢復可再抽
      setShowSymbol(null);
      setSelectedNumber(null);
    }, 1000);
  };

  return (
    <div className="flex flex-col items-center justify-center space-y-4 p-4">
      {/* 跑馬燈圖片或符號 */}
      <div className="w-[500px] h-[300px] flex items-center justify-center bg-gray-100 rounded-2xl shadow-inner overflow-hidden">
        {showSymbol ? (
          <span className="text-[150px]">{showSymbol}</span>
        ) : currentImage ? (
          <img
            src={currentImage}
            alt="題目圖片"
            className="object-contain w-full h-full transition-all duration-300"
          />
        ) : (
          <span className="text-gray-400 text-xl">請抽題</span>
        )}
      </div>

      {/* 選號器 */}
      <div className="flex flex-wrap justify-center gap-3 w-[400px]">
        {numbers.map((num) => (
          <Button
            key={num}
            onClick={() => handleSelectNumber(num)}
            variant={selectedNumber === num ? "secondary" : "outline"}
            className="text-lg w-12 h-12"
          >
            {num}
          </Button>
        ))}
      </div>

      {/* 圈叉按鈕 */}
      <div className="flex gap-6 mt-2">
        <Button
          onClick={() => handleSymbolClick("⭕")}
          className="bg-green-500 hover:bg-green-600 text-white w-12 h-12 text-2xl rounded-full"
        >
          ⭕
        </Button>
        <Button
          onClick={() => handleSymbolClick("❌")}
          className="bg-red-500 hover:bg-red-600 text-white w-12 h-12 text-2xl rounded-full"
        >
          ❌
        </Button>
      </div>
    </div>
  );
}
